var viewFile=function(e,t,i,r){if(i)return getFileView(e,t,r);switch(e){case"image":case"img":var o,a,l=Alloy.createController("viewFile/viewFile").getView(),a=Ti.UI.createImageView({height:Ti.Platform.displayCaps.platformHeight-10,image:t,opacity:1,zIndex:1});l.children[1].add(a);var n,s,d=!1,c=1,_=Titanium.UI.create2DMatrix();l.children[1].addEventListener("pinch",function(e){d=!0;var t=1;e.scale.toFixed(2)!=c&&(t=1+(e.scale-c),c=e.scale.toFixed(2),t>0&&(_=_.scale(t)),a.transform=_)}),a.addEventListener("touchend",function(){d=!1}),a.addEventListener("touchstart",function(e){c=1,curX=e.x,curY=e.y}),a.addEventListener("touchmove",function(e){d||(n=e.x-curX,s=e.y-curY,_=_.translate(n,s),a.animate({transform:_,duration:100}))}),l.open({theme:"Theme.noActionBar",transition:Titanium.UI.iPhone.AnimationStyle.CURL_UP});break;case"pdf":var o=Ti.Filesystem.getFile(Ti.Filesystem.tempDirectory,r.fileName||"test.pdf");o.write(t);var p=Titanium.UI.createWebView({width:"100%",height:"100%",zIndex:1});p.setData(o.read());var u=Ti.UI.iOS.createDocumentViewer();u.setUrl(Ti.Filesystem.tempDirectory+(r.fileName||"test.pdf")),u.show();break;case"doc":var o=Ti.Filesystem.getFile(Ti.Filesystem.tempDirectory,r.fileName||"test.doc");o.write(t);var u=Ti.UI.iOS.createDocumentViewer();u.setUrl(Ti.Filesystem.tempDirectory+(r.fileName||"test.doc")),u.show()}},getFileView=function(e,t,i){switch(e){case"jpg":case"png":case"jpeg":if(t.attachment)var r=t.attachment;else t.image?r=t.image:t.img&&(r=t.img);var o=Ti.UI.createImageView({image:Ti.Utils.base64decode(r)});return o.addEventListener("click",function(e){viewFile("img",e.source.image)}),o;case"pdf":var o,a=Ti.Filesystem.getFile(Ti.Filesystem.tempDirectory,i.fileName||"test.pdf");a.write(Ti.Utils.base64decode(t.attachment));var l=Titanium.UI.createWebView({width:"100%",height:"100%",zIndex:1});l.setData(a.read());var n=Ti.UI.createView({width:Ti.UI.FILL,height:Ti.UI.FILL}),s=Ti.UI.createImageView({image:"/others/newOpen.png",top:"0dp",left:"0dp",width:"30dp",height:"30dp",zIndex:100,backgroundColor:"black",opacity:.7,pdf:Ti.Utils.base64decode(t.attachment)});return s.addEventListener("click",function(e){viewFile("pdf",e.source.pdf,!1,{})}),n.add(l),n.add(s),n;case"doc":var o=Ti.UI.createImageView({image:"/others/Office_DOC.png",doc:Ti.Utils.base64decode(t.attachment),width:"100%",height:"100%",focusable:!0});return o.addEventListener("click",function(e){viewFile("doc",e.source.doc,!1,{})}),o}};exports.viewFile=viewFile;